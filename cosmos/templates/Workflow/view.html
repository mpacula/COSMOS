{% extends "base.html" %}
{% load url from future %}
{% load extras %}

{% block head %}
    <script type="text/javascript">
    $(document).ready(function(){
        update_html = function(selector,url){
            //updates selector with the html from url every second
                jQuery.ajax({
                     url:    url,
                     success: function(result) {
                                  $(selector).html(result),
                                  setTimeout("update_html('"+selector+"','"+url+"')",1000)
                              },
                     async:   true,
                }); 
            }
        update_html('#stages','{% url 'workflow_stage_table' workflow.id %}')
    });
    </script>
{% endblock %}
{%block content%}

<ul class="breadcrumb">
  <li><a href="/Workflow/">Workflows</a> <span class="divider">/</span></li>
  <li class="active">{{workflow}}</li>
</ul>

<h1>{{workflow}}
	<a href="{% url 'workflow_view_log' workflow.id %}"><button class="btn btn-info"><i class="icon-search icon-white"></i> Log</button></a>
	<a href="{% url 'workflow_analysis' workflow.id %}"><button class="btn btn-info"><i class="icon-wrench icon-white"></i> Analyze</button></a>
    <a href="{% url 'workflow_visualize' workflow.id %}"><button class="btn btn-info"><i class="icon-cog icon-white"></i> Visualize</button></a>
</h1>

<dl class="dl-horizontal">
<dt>Output Dir</dt><dd>{{workflow.output_dir}}</dd>
{% if workflow.default_queue %}
<dt>Default Queue</dt><dd>{{workflow.default_queue}}</dd>
{% endif %}
<dt>Created on</dt><dd>{{workflow.created_on}}</dd>
<dt>Finished on</dt><dd>{{workflow.finished_on}}</dd>
<dt>Wall Time</dt><dd>{{workflow.wall_time.seconds|format_time}}</dd>
<dt>Total Stage Wall Time</dt><dd>{{workflow.total_stage_wall_time.seconds|format_time}}</dd>
</dl>

<p><h3>Stages</h3>
</p>
<div id="stages">
{%with stages=stages_ordered%}
    {%include "Workflow/Stage/table.html"%}
{%endwith%}
</div>
{%endblock%}